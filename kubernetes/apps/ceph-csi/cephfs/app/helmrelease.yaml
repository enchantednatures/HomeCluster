apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ceph-csi-cephfs
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://ceph.github.io/csi-charts
      chart: ceph-csi-cephfs
      version: 3.12.2
      sourceRef:
        kind: HelmRepository
        name: ceph-charts
        namespace: flux-system
      interval: 5m
  #See https://github.com/ceph/ceph-csi/blob/devel/charts/ceph-csi-cephfs/values.yaml
  values:
    csiConfig:
      - clusterID: "2dfc66d7-e873-4748-bf58-94cd5be2de85" #just a UUID
        monitors:
          - 192.168.1.240
        cephFS:
          subvolumeGroup: ""
    nodeplugin:
      # ... other configurations ...

      podSecurityContext:
        privileged: true
        capabilities:
          add: ["SYS_ADMIN"]
        allowPrivilegeEscalation: true
        hostNetwork: true
        hostPID: true
        hostIPC: true
        seLinuxContext:
          type: "runtimeDefault"
        seccompProfile:
          type: "RuntimeDefault"

      plugin:
        # ... existing image config ...
        securityContext:
          privileged: true
          capabilities:
            add: ["SYS_ADMIN"]
          allowPrivilegeEscalation: true
          seLinuxContext:
            type: "runtimeDefault"
          seccompProfile:
            type: "RuntimeDefault"

    provisioner:
      # ... other configurations ...

      podSecurityContext:
        runAsNonRoot: true
        seccompProfile:
          type: "RuntimeDefault"
        seLinuxContext:
          type: "runtimeDefault"
