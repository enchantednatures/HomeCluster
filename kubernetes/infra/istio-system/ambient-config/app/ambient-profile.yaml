---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/istio.io/v1beta1.json
apiVersion: istio.io/v1beta1
kind: AmbientProfile
metadata:
  name: default
  namespace: istio-system
spec:
  # Define ambient mesh profile
  profile: ambient
  # Configure ambient mesh settings
  ambient:
    # Enable ambient mode
    enabled: true
    # Configure waypoint proxies
    waypoint:
      enabled: true
      # Configure waypoint proxy settings
      resources:
        requests:
          cpu: 200m
          memory: 256Mi
        limits:
          cpu: 1000m
          memory: 1Gi
    # Configure ztunnel settings
    ztunnel:
      enabled: true
      # Configure ztunnel networking
      networking:
        # Enable ambient networking
        enabled: true
        # Configure ambient mesh ports
        ports:
          - name: ambient-mesh
            port: 15008
            protocol: TCP
          - name: ambient-mesh-tls
            port: 15006
            protocol: TCP
    # Configure ambient mesh policies
    policies:
      # Enable ambient mesh policies
      enabled: true
      # Configure default policies
      default:
        # Enable mTLS by default
        mtls:
          mode: STRICT
        # Enable ambient mesh telemetry
        telemetry:
          enabled: true
          # Configure telemetry settings
          metrics:
            enabled: true
            port: 15020
          tracing:
            enabled: true
            port: 15031
          logging:
            enabled: true
            level: info