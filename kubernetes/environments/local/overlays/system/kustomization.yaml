# yaml-language-server: $schema=https://json.schemastore.org/kustomization
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: local-system

resources:
  # Core system services (local-friendly)
  - ../../../apps/kube-system/cilium
  - ../../../apps/kube-system/coredns
  - ../../../apps/kube-system/metrics-server
  - ../../../apps/kube-system/reloader
  
  # Istio service mesh (for local KNative testing)
  - ../../../apps/istio-system/base
  - ../../../apps/istio-system/cni
  - ../../../apps/istio-system/istiod

# Local patches for system components
patches:
  # Simplify Cilium config for local development
  - target:
      kind: HelmRelease
      name: cilium
    patch: |-
      - op: replace
        path: /spec/values/l2announcements/enabled
        value: false
      - op: replace
        path: /spec/values/externalIPs/enabled
        value: false